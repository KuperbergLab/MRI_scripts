==Introduction==

The goal of this page is to explain what the --run_ica pipeline command does.  I'll leave the nitty-gritty explanation of ICA to the experts (see links at the bottom).

==What Happens==

In SemPrMM/MEG/scripts, there exists generic_ica.m that looks like this:
 run_all_ica({'$subject'});
 exit;
Nothing too fancy, right?<br>
The pipeline copies this file to MEG/data/$subject/ and replaces the $subject placeholder in the text with the subject you called the pipeline with. A logfile is created at MEG/data/$subject/logs/$subject_ica.log and this process is started:
 matlab -nodisplay -nosplash -nodesktop < MEG/data/$subject/$subject_ica.m > MEG/data/$subject/logs/$subject_ica.log
Finally, all resulting files are changed to the 'lingua' unix group. <br>

run_all_ica is a little more interesting (but not by much):

 function run_all_ica(subject_cell)
 warning off all
 
 for s = subject_cell
     subject = s{1};
     fif2wts(subject,pwd);
     fifwts2blinks(subject,pwd);
     sendmail('sburns@nmr.mgh.harvard.edu',['finished ica for ' subject]);
 end
 
 exit;
I'll give fif2wts.m and fifwts2blinks their own sections.

===fif2wts.m===
This function begins by searching for the following unix-style wildcards:
*   *_ATLLoc_raw.fif
*   *_Baleen*_raw.fif
*   *_MaskedMM*_raw.fif
*   *_AXCPT*_raw.fif
For every one of those .fif files, it does the following:
*   setup and read the raw data from the EEG channels
*   partition the file name by '.' and creating a variable called for instance ya31_ATLLoc_raw_ica.mat, where the results of the ICA will be stored.
*   Run the ICA on the data matrix, producing variables for weights and spheres
*   Save these variables to the preceeding filename
*   Exit
Basically, this is just a fancy wrapper for the runica function provided in EEGLab.

===fifwts2blinks===
This function is a little more fancy, but not by much. It begins by searching for these wildcards:
*   *_ATLLoc_raw.fif and  *_ATLLoc_raw*.mat
*   *_Baleen*_raw.fif and *_Baleen*_raw*.mat
*   *_MaskedMM*_raw.fif and *_MaskedMM*_raw*.mat
*   *_AXCPT*_raw.fif and *_AXCPT*_raw*.mat
Given these files, it does the following for each .fif/.mat pair:
*   Load the EEG data from the .fif and ICA data from the .mat
*   Construct U, the source time course matrix, given by U = wts (the unmixing matrix) and X (the data matrix)
*   Find the largest ranging source, which is predominantly the eye blink source.
*   Find the peaks and locations of this source, thereby giving us time points at which blinks occured.
*   Write the time points to disk, taking into account the sample offset (time between starting MEG system and recording)









==Links==
*   [http://sccn.ucsd.edu/eeglab/allfunctions/runica.html runica function doc]
*   [http://sccn.ucsd.edu/wiki/Chapter_09:_Decomposing_Data_Using_ICA EEGLab's Discussion of decomposing data using ICA]
*   [http://sccn.ucsd.edu/papers/OntonMakeig_ICAERSP06.pdf Technical paper discussing ICA from EEGLab group]
*   [http://en.wikipedia.org/wiki/Independent_component_analysis Wikipedia: ICA]
