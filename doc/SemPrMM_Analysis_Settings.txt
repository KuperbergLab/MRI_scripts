==Introduction==
This document clearly spells out the exact settings we're using for preprocessing, 1st-level,
group-level, and ROI analyses.  Hopefully it will help future RAs, techs, and post-docs get a new
MRI study underway quickly and painlessly (as much as possible, anyways).

==SPM==
===Preprocessing===
We use SPM's batch processing to do preprocessing.  These six nodes, in this order, define our
entire preprocessing pipeline:
*   Realign: Estimate and Reslice
**  Data
*** (1 or more sessions)
**  Estimation Options
*** Quality: 0.9
*** Separation: 4
*** Smoothing (FWHM): 5
*** Num passes: Register to first
*** Interpolation: 4th-degree B-spline
*** Wrapping: no wrap
*** Weighting: None
**  Reslice Options
*** Resliced Images: All images + mean image
*** Interpolation: 4th-degre B-spline
*** Warpping: no wrap
*** Filename prefix: 'r'
*   Slice Timing
**  Data: The resliced images from Realign: Estimate and Reslice
**  Number of slices: 36
**  TR: 2
**  TA: 1.94444444 (2 - (2/36))
**  Slice order: [1 3 5 7 9 11 13 15 17 19 21 23 25 27 29 31 33 35 2 4 6 8 10 12 14 16 18 20 22 24
26 28 30 32 34 36]
**	Reference Slice: 1
**	Filename Prefix: a
* 	Coreg: Esitmate and Reslice
**	Reference Image: Realign: Estimate and Reslice Mean Image
**	Source Image: Subject's MPRAGE
**	Other Images: None
**	Estimation Options
***	Objective Function: Normalised Mutual Information
***	Seperation: [4 2]
***	Tolerances: [0.02
	0.02	0.02	0.001	0.001	0.001	0.01	0.01	0.01	0.001	0.001	0.001]
***	Histogram Smoothing: [7 7]
**	Reslice Options
***	Interpolation: Trilinear
***	Wrapping: No warp
***	Masking: Don't mask images
***	Filename prefix: c
*	Segment
**	Data: Coreg:Estimate and Reslice Coregistered Images
**	Output Files
***	Grey Matter: Native Space
***	White Matter: Native Space
***	Cerebro-Spinal Fluid: None
***	Bias corrected: Save bias corrected
***	Clean up any partitions: Don't do cleanup
**	Custom
***	Tissue Probability Maps: [default]
***	Gaussians per class: [2 2 2 4]
***	Affine regularisation: ICBM space template-European Brains
***	Warping regularisation: 1
***	Warp Frequency Cutoff: 25
***	Bias regularisation: very light regularisation (0.0001)
***	Bias FWHM: 60mm
***	Sampling distance: 3
***	Masking image: None
*	Normalize: Write
**	Data
***	Subject
****	Parameter file: Segment:Norm Params Subj->MNI
****	Images to write: Slice Timing: Slice Timing Corr. Images (all sessions)
**	Writing Options
***	Preserve: Preserve Concentrations
***	Bounding Box: [ -78 -112 -70, 78 76 85]
***	Voxel Sizes: [2 2 2]
***	Interpolation: 4th Degree Bspline
***	Wrapping: No wrap
***	Filename prefix: w
*	Smooth
**	Images to smooth: Normalise: Write: Normalised Images(Subj 1)
**	FWHM: [8 8 8]
**	Data type: SAME
**	Implicit masking: no
**	Filename prefix: s8

====How it's implemented====
SPM preprocessing is implemented with the pipeline options --setup_preproc and --run_preproc.  

===First Level Statistics===
Much like with SPM preprocessing, first-level statistics processing are described with an SPM batch consisting of these three nodes:
*	fMRI model specification
**	Directory: (directory where you want the SPM.mat and stat images)
**	Timing Parameters
***	Units for design: seconds
***	Interscan Interval: 2 (the TR)
***	Microtime resolution: 16
***	Microtime onset: 1
**	Data & design
***	Subject/Session (one of these for each run)
****	Scans: the data
****	Conditions: one for each condition
*****	Name: condition name
*****	Onsets: Vector of onset times
*****	Durations: vector of durations
*****	Time Modulation: no time modulation
*****	Parametric modulations: none
****	Multiple Conditions: none
****	Regressors: None
****	Multiple Regressors: the art_regression_outliers_and_movement_(par)(run).mat file produced with --run_art
****	High-pass filter: 128
**	Factorial Design: (empty)
**	Basis Functions
***	Canonical hrf
****	Model derivatives: none
**	Model Interactions: do not model interactions
**	Global normalisation: None
**	Explicit mask: None
**	Serial correlations: AR(1)
*	Model Estimation
** 	SPM.mat: SPM.mat from fMRI model specification
**	Method
***	Classical
*	Contrast Manager
**	SPM.mat: from Model Estimation
**	Contrast sessions
***	T Contrast (one for each contrast)
****	Name: contrast name
****	T contrast vector: a N-condition wide vector corresponding to the contrast
****	Replicate over sessions: yes
**	Delete existing contrasts: yes

====How it's implemented====
First-level statistics are implemented with the --setup_outliers and --run_outliers pipeline options.

===Group-Level Statistics===
Like any other SPM processing, this involves a batch file.  Here's the nodes:
* 	Factorial Design Specification
**	Directory: directory to put SPM.mat and stat images
**	Design
***	One-sample T Test
****	Scans: contrast images from 1st level
**	Covariates: none
**	Masking
***	Threshold Masking
****	None
***	Implicit mask: yes
***	Expliciit mask: None
**	Global calculation
***	Omit
**	Global normalisation
***	Overal grand mean scaling
****	No
***	Normalisation: None
*	Model Estimation
** 	SPM.mat: SPM.mat from fMRI model specification
**	Method
***	Classical
* 	Contrast Manager
** 	SPM.mat: SPM.mat from Factorial Design Specification
**	contrasts
***	T contrast
***	Vector: [1]
*** Delete existing contrasts: yes

====How it's implemented====
This functionality is implemented with --setup_second and --run_second pipeline options.
==FSFast==
===Preprocessing/1st Level Statistics===

FSFast works much differently than SPM.  Instead of defining the preprocessing options every time as is done with SPM, FSFast allows you to define an entire analysis in one command (mkanalysis-sess), saving it to a text file.  Then, to run process the entire first-level for a subject (with selxavg-sess), you just need to provide the name of the analysis and data.<br>
The following options are used with mkanalysis-sess:
*	Preprocessing options
**	-fsd: the paradigm folder (ATLLoc, BaleenHP, etc)
**	-fwhm 8 
**	-stc siemens 
**	-surface fsaverage lh (or rh) (for surface analyses)
**	-mni305 2 (for volumetric analyses)
**	-mcextreg

*	Statistics options:
**	-p: (the pardigm file) lower-case paradigm.par (eg, atlloc.par)
**	-nconditions (this will depend on your paradigm) 
**	-tpexclude lower-case paradigm.tpef 
**	-event-related 
**	-TR 2
**	-spmhrf 0 (for hrf analyses)
**	-refeventdur 2 (for hrf analyses)
**	-fir 4 20 (for fir analyses)
**	-TER 2 (for fir analyses)

====How it's implemented====
Setting up the analyses can be done with --setup_fs_analysis.  This writes out 5 (par)_fs-analysis.sh files in MRI/functionals/fsfast_scripts/ that should then be executed once and only once.<br>

The --setup_fs_stats and --run_fs_stats are the options you need to process a subject with the pipeline.

===Group-Level Statistics===
FSFast provides isxconcat-sess for combining the first level contrast estimates into one large data file, which mri_glmfit is then operated on.  mri_glmfit by default does a one-sample group-mean t test, much like the SPM group analysis detailed above.

====How it's implemented====
The --setup_fs_group (makes the isxconcat-sess scripts) and --setup_fs_glm (makes the mri_glmfit scripts) are the pipeline options to look at.

==ROI==
===FSFast===
